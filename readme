# prerequisites quick installation in scripts folder 
kubectl
helm
node js 20.15.1
wsl or linux ubuntu machine 
minikube + docker
# get started 
  make start -> deploy the project on k8s
  make start-local -> for developer run the sever locally and communicate with k8s through mirrord
# architecture
all releated to architecture stuff in docs folder
#create load 
mirrord exec -- sh ./hack/loadtest.sh

# don't forget to use bash because node js doens't work with shell so mirord will not work with shell 

kubectl port-forward mongo-express-6cfbc86cb6-prfs5 8081:8081



kubectl get pods | grep prometheus-server | awk '{kubectl port-forward $1 }'


for pod in $(kubectl get pods --no-headers | grep  'prometheus-server' | awk '{print $1}'); do
    kubectl port-forward "$pod" 9090:9090
done

for pod in $(kubectl get pods --no-headers | grep 'node' | awk '{print $1}'); do
    kubectl port-forward "$pod" 3001:3001
done

    kubectl port-forward svc/node-customerserver 3001:3001
    kubectl port-forward  svc/prometheus-server 9090:80

    





# uninstall keda
kubectl delete $(kubectl get scaledobjects.keda.sh,scaledjobs.keda.sh -A \
  -o jsonpath='{"-n "}{.items[*].metadata.namespace}{" "}{.items[*].kind}{"/"}{.items[*].metadata.name}{"\n"}')
helm uninstall keda -n keda

for i in $(kubectl get scaledobjects -A \
  -o jsonpath='{"-n "}{.items[*].metadata.namespace}{" "}{.items[*].kind}{"/"}{.items[*].metadata.name}{"\n"}');
do kubectl patch $i -p '{"metadata":{"finalizers":null}}' --type=merge
done

for i in $(kubectl get scaledjobs -A \
  -o jsonpath='{"-n "}{.items[*].metadata.namespace}{" "}{.items[*].kind}{"/"}{.items[*].metadata.name}{"\n"}');
do kubectl patch $i -p '{"metadata":{"finalizers":null}}' --type=merge
done

